-- Copyright The Total RP 3 Authors
-- SPDX-License-Identifier: Apache-2.0

--[[
	Backdrop Tables
--]]

TRP3_BACKDROP_COLOR_DARK = CreateColor(0.4, 0.4, 0.4);

TRP3_BACKDROP_DIALOG_20_20_5555 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 20,
	edgeSize = 20,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_PARTY_DIALOG_16_16_5555 = {
	bgFile   = "Interface\\CHARACTERFRAME\\UI-Party-Background",
	edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 16,
	edgeSize = 16,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_200_24_5555 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 200,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_400_24_5555 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 400,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_TOOLTIP_0_24_5555 = {
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_TOOLTIP_400_24_5555 = {
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 400,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_TOOLTIP_0_16 = {
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	edgeSize = 16,
};

TRP3_BACKDROP_TOOLTIP_0_24 = {
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	edgeSize = 24,
};

TRP3_BACKDROP_TOOLTIP_415_16_3333 = {
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 16,
	insets   = { left = 3, right = 3, top = 3, bottom = 3 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_380_16_3333 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 380,
	edgeSize = 16,
	insets   = { left = 3, right = 3, top = 3, bottom = 3 },
};

TRP3_BACKDROP_MIXED_MARBLE_TOOLTIP_415_24_5555 = {
	bgFile   = "Interface\\FrameGeneral\\UI-Background-Marble",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_BANK_TOOLTIP_400_24_5555 = {
	bgFile   = "Interface\\BankFrame\\Bank-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 400,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_BANK_TOOLTIP_100_16_4222 = {
	bgFile   = "Interface\\BankFrame\\Bank-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 100,
	edgeSize = 16,
	insets   = { left = 4, right = 2, top = 2, bottom = 2 },
};

TRP3_BACKDROP_MIXED_TUTORIAL_TOOLTIP_418_16_3353 = {
	bgFile   = "Interface\\TutorialFrame\\TutorialFrameBackground",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 418,
	edgeSize = 16,
	insets   = { left = 3, right = 3, top = 5, bottom = 3 },
};

TRP3_BACKDROP_ACHIEVEMENTS_32_64_5555 = {
	edgeFile = "Interface\\AchievementFrame\\UI-Achievement-WoodBorder",
	tile     = true,
	tileEdge = true,
	tileSize = 32,
	edgeSize = 64,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_PARCHMENT_TOOLTIP_415_16_5555 = {
	bgFile   = "Interface\\AchievementFrame\\UI-Achievement-Parchment",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 16,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_0_16_3333 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	edgeSize = 16,
	insets   = { left = 3, right = 3, top = 3, bottom = 3 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_415_16_3333 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 16,
	insets   = { left = 3, right = 3, top = 3, bottom = 3 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_415_24_5555 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_415_16_5555 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 16,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_DIALOG_TOOLTIP_0_16_5555 = {
	bgFile   = "Interface\\DialogFrame\\UI-DialogBox-Background",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	edgeSize = 16,
	insets   = { left = 5, right = 5, top = 5, bottom = 3 },
};

TRP3_BACKDROP_GOLD_DIALOG_0_26 = {
	edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Gold-Border",
	edgeSize = 26,
};

TRP3_BACKDROP_MIXED_TUTORIAL_TOOLTIP_418_16_5353 = {
	bgFile   = "Interface\\TutorialFrame\\TutorialFrameBackground",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 418,
	edgeSize = 16,
	insets   = { left = 5, right = 3, top = 5, bottom = 3 },
};

TRP3_BACKDROP_MIXED_ACHIEVEMENT_TOOLTIP_415_24_5555 = {
	bgFile   = "Interface\\AchievementFrame\\UI-Achievement-StatsBackground",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 24,
	insets   = { left = 5, right = 5, top = 5, bottom = 5 },
};

TRP3_BACKDROP_MIXED_ACHIEVEMENT_TOOLTIP_415_16_3333 = {
	bgFile   = "Interface\\AchievementFrame\\UI-Achievement-StatsBackground",
	edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
	tile     = true,
	tileEdge = true,
	tileSize = 415,
	edgeSize = 16,
	insets   = { left = 3, right = 3, top = 3, bottom = 3 },
};

--[[
	TRP3_TruncatedTextMixin
--]]

TRP3_TruncatedTextMixin = CreateFromMixins(FontableFrameMixin);

function TRP3_TruncatedTextMixin:OnLoad()
	if not self.Text then
		self.Text = self:CreateFontString(nil, self.fontStringLayer, self.fontStringTemplate, self.fontStringSubLayer);
		self.Text:SetAllPoints(self);
	end

	if self.fontStringColor then
		self.Text:SetTextColor(self.fontStringColor);
	end

	if self.fontStringJustifyH then
		self.Text:SetJustifyH(self.fontStringJustifyH);
	end

	if self.fontStringJustifyV then
		self.Text:SetJustifyV(self.fontStringJustifyV);
	end
end

function TRP3_TruncatedTextMixin:GetText()
	return self.Text:GetText();
end

function TRP3_TruncatedTextMixin:IsTruncated()
	return self.Text:IsTruncated();
end

function TRP3_TruncatedTextMixin:SetFormattedText(format, ...)
	return self.Text:SetFormattedText(format, ...)
end

function TRP3_TruncatedTextMixin:SetText(text)
	return self.Text:SetText(text);
end

--[[override]] function TRP3_TruncatedTextMixin:OnFontObjectUpdated()
	self.Text:SetFontObject(self:GetFontObject());
end

TRP3_TooltipMixin = {};

function TRP3_TooltipMixin:SetCenterColor(r, g, b, a)
	if not self.SetBackdropColor then
		self.NineSlice:SetCenterColor(r, g, b, a or 1);
	else
		-- Classic/BCC: Use legacy Backdrop APIs.
		self:SetBackdropColor(r, g, b, a or 1);
	end
end

function TRP3_TooltipMixin:SetBorderColor(r, g, b, a)
	if not self.SetBackdropBorderColor then
		self.NineSlice:SetBorderColor(r, g, b, a or 1);
	else
		-- Classic/BCC: Use legacy Backdrop APIs.
		self:SetBackdropBorderColor(r, g, b, a or 1);
	end
end

TRP3_TextAreaBaseMixin = {};

function TRP3_TextAreaBaseMixin:OnLoad()
	local editbox = self:GetEditBox();
	editbox:RegisterCallback("OnEditFocusGained", self.OnEditFocusGained, self);
	editbox:RegisterCallback("OnEditFocusGained", self.OnEditFocusLost, self);
end

function TRP3_TextAreaBaseMixin:OnShow()
	self:UpdateLayout();
end

function TRP3_TextAreaBaseMixin:OnSizeChanged()
	self:UpdateLayout();
end

function TRP3_TextAreaBaseMixin:OnEditFocusGained()
	local focus = self:GetFocusFrame();
	focus:Hide();
end

function TRP3_TextAreaBaseMixin:OnEditFocusLost()
	local focus = self:GetFocusFrame();
	focus:Show();
end

function TRP3_TextAreaBaseMixin:GetEditBox()
	return self.scroll.text;
end

function TRP3_TextAreaBaseMixin:GetFocusFrame()
	return self.dummy;
end

function TRP3_TextAreaBaseMixin:UpdateLayout()
	local editbox = self:GetEditBox();
	editbox:SetWidth(self:GetWidth() - 40);
end

TRP3_TextAreaBaseEditBoxMixin = CreateFromMixins(CallbackRegistryMixin);
TRP3_TextAreaBaseEditBoxMixin:GenerateCallbackEvents({
	"OnEditFocusGained",
	"OnEditFocusLost",
});

function TRP3_TextAreaBaseEditBoxMixin:OnLoad()
	CallbackRegistryMixin.OnLoad(self);
	ScrollingEdit_OnLoad(self);
end

function TRP3_TextAreaBaseEditBoxMixin:OnCursorChanged(x, y, w, h)
	ScrollingEdit_OnCursorChanged(self, x, y, w, h);
end

function TRP3_TextAreaBaseEditBoxMixin:OnTextChanged()
	ScrollingEdit_OnTextChanged(self, self:GetScrollFrame());
end

function TRP3_TextAreaBaseEditBoxMixin:OnEscapePressed()
	self:ClearFocus();
end

function TRP3_TextAreaBaseEditBoxMixin:OnEditFocusGained()
	self:TriggerEvent("OnEditFocusGained", self);
end

function TRP3_TextAreaBaseEditBoxMixin:OnEditFocusLost()
	self:HighlightText(0, 0);
	self:TriggerEvent("OnEditFocusLost", self);
end

function TRP3_TextAreaBaseEditBoxMixin:GetScrollFrame()
	return self:GetParent();
end
